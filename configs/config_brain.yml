# Brain dataset configuration for T2*-MOVE data
# This config is for multi-echo brain MRI with Cartesian k-space

# data config
data_root: /u/home/nguyv/Documents/data/helmholtz/val_recon
type: brain
subject: sub-07  # Options: sub-07, sub-08, sub-09
# If omitted, the first .h5/.hf under subject folder will be used
file_name: t2s_gre_fr.hf
# Optional coil selection (0-based indices). If omitted, use all coils
is_selected: True # If True, filter by selected slices, echoes, and coils. If False, use all available.
selected_coils: [0,1,2,3]  # Only these coils will be used when is_selected=True
selected_echoes: [0,1,2,3]  # Only these echoes will be used when is_selected=True
selected_slices: [14,15,16,17]  # Select slice from 0-35 (36 slices total). Only these slices will be used when is_selected=True
batch_size: 300000
num_workers: 4
sample_per_epoch: 100

# model config for mlp
model: nerf
coord_dim: 4  # [slice, kx, ky, echo]
num_layers: 8
feature_dim: 512
out_dim: 1
use_polar_inputs: True  # Append [r, theta] to inputs for angular structure
omega0_first: 60.0
omega0_hidden: 1.0

# train config
num_epochs: 1001
lr: 3e-5
# Learning rate scheduler options: 'cosine', 'step', 'exponential', 'plateau', or None
lr_scheduler: cosine  # Recommended: cosine for smooth decay
lr_min: 1e-6  # Minimum learning rate for cosine scheduler
lr_gamma: 0.5  # Decay factor for step/exponential scheduler
lr_step_size: 167  # Step size for step scheduler (num_epochs / 3)
# Gradient clipping for training stability (None to disable, or positive value)
max_grad_norm: 1.0  # Clip gradients to this norm

# loss config
# Options: 'hdr_ff', 'weighted_hdr', 'mixed', 'adaptive_hdr', 'mse', 'complex_spectral'
# Recommended for spectral underfitting: 'complex_spectral'
loss_type: complex_spectral

# ComplexSpectralLoss params
lambda_k: 1.0
lambda_angle: 0.2
lambda_log: 0.1
radial_alpha: 1.5
use_radial_weight: True
spectral_eps: 1e-6
lambda_angle_start: 0.05
lambda_log_start: 0.02
spectral_warmup_steps: 200

# Legacy HDR params (kept for compatibility if switching losses)
hdr_eps: 1e-2
hdr_ff_sigma: 1
hdr_ff_factor: 0
low_freq_weight: 2.0

# recon config
# For brain dataset: echoes treated as temporal dimension; sizes validated at load
kx: 92  # k-space x dimension (validated from file)
ky: 224  # k-space y dimension (may include oversampling)

# experiment summary config
exp_summary: wandb
# wandb config
wandb_project: NIK_MRI_Brain

